<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Headless execution - COMOKIT Documentation</title><meta name="Description" content="How to use COMOKIT in headless mode on HPC."><link rel="shortcut icon" href="https://comokit.org/docs/assets/images/logo.png" type="image/x-icon"><link rel="stylesheet" href="https://comokit.org/docs/assets/css/just-the-docs.css"> <script type="text/javascript" src="https://comokit.org/docs/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="https://comokit.org/docs/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Headless execution | COMOKIT Documentation</title><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Headless execution" /><meta property="og:locale" content="en_US" /><meta name="description" content="How to use COMOKIT in headless mode on HPC." /><meta property="og:description" content="How to use COMOKIT in headless mode on HPC." /><link rel="canonical" href="https://comokit.org/docs/headless" /><meta property="og:url" content="https://comokit.org/docs/headless" /><meta property="og:site_name" content="COMOKIT Documentation" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Headless execution" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"How to use COMOKIT in headless mode on HPC.","headline":"Headless execution","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://comokit.org/docs/assets/images/logo.png"}},"url":"https://comokit.org/docs/headless"}</script><link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet"><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"><title>Link</title><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg><div class="page-wrap"><div class="side-bar"><div class="site-header"> <a href="https://comokit.org" class="site-title lh-tight"><div class="site-logo" style="background-position: center center;"></div></a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button></div><div class="navigation main-nav js-main-nav"><nav role="navigation" aria-label="Main navigation"><ul class="navigation-list"><li class="navigation-list-item"><a href="https://comokit.org/docs/" class="navigation-list-link">Home</a><li class="navigation-list-item"><a href="https://comokit.org/docs/gettingStarted" class="navigation-list-link">Getting Started</a><li class="navigation-list-item"><a href="https://comokit.org/docs/parameterize" class="navigation-list-link">Parameterizing simulations</a><li class="navigation-list-item"><a href="https://comokit.org/docs/setupYourOwn" class="navigation-list-link">Applying COMOKIT</a><li class="navigation-list-item active"><a href="https://comokit.org/docs/headless" class="navigation-list-link active">Headless execution</a><li class="navigation-list-item"><a href="https://comokit.org/docs/odd" class="navigation-list-link">Model description</a><li class="navigation-list-item"><a href="https://comokit.org/docs/officialExtensions" class="navigation-list-link">Official COMOKIT extensions</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://comokit.org/docs/officialExtensions/C-Albatross" class="navigation-list-link">COMOKIT Albatross</a></ul><li class="navigation-list-item"><a href="https://comokit.org/docs/press" class="navigation-list-link">Press</a><li class="navigation-list-item"><a href="https://comokit.org/docs/version1" class="navigation-list-link">Version 1.0.1</a><li class="navigation-list-item"><a href="https://comokit.org/docs/version2" class="navigation-list-link">Version 2.0</a></ul></nav></div></div><div class="main-content-wrap js-main-content" tabindex="0"><div class="main-content"><div class="page-header js-page-header" id="top"><div class="search"><div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search COMOKIT Documentation" aria-label="Search COMOKIT Documentation" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg></div><div class="js-search-results search-results-wrap"></div></div><ul class="list-style-none text-small aux-nav"><li class="d-inline-block my-0"><a href="https://github.com/COMOKIT/COMOKIT-Model">COMOKIT on GitHub</a></ul></div><div class="page"><div id="main-content" class="page-content" role="main"><h1 class="no_toc" id="headless-execution"> <a href="#headless-execution" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Headless execution</h1><p class="fs-6 fw-300">COMOKIT has also been made to explore his model and run in headless mode on server or <a href="https://en.wikipedia.org/wiki/High-performance_computing">HPC</a>.</p><h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Table of contents</h2><ol id="markdown-toc"><li><a href="#introduction" id="markdown-toc-introduction">Introduction</a><li><a href="#getting-started" id="markdown-toc-getting-started">Getting started</a><ol><li><a href="#before-installation" id="markdown-toc-before-installation">Before installation</a><li><a href="#installation" id="markdown-toc-installation">Installation</a><li><a href="#setting-up-your-server" id="markdown-toc-setting-up-your-server">Setting up your server</a></ol><li><a href="#how-to-use" id="markdown-toc-how-to-use">How to use:</a><ol><li><a href="#generate-xml" id="markdown-toc-generate-xml">Generate XML</a><li><a href="#example-usage" id="markdown-toc-example-usage">Example usage</a><li><a href="#advanced-usage" id="markdown-toc-advanced-usage">Advanced usage</a></ol><li><a href="#launch-headless" id="markdown-toc-launch-headless">Launch headless</a></ol><hr /><h2 id="introduction"> <a href="#introduction" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Introduction</h2><p>COMOKIT has also been developped to be run in <a href="https://en.wikipedia.org/wiki/Headless_software">headless mode</a>. To do so, it is using the <a href="https://gama-platform.github.io/wiki/Headless">GAMA Headless</a> feature which allows to run GAMA on a server without graphical interfaces.</p><p>To simplify this usage, we developped some tools allowing this configuration.</p><h2 id="getting-started"> <a href="#getting-started" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Getting started</h2><h3 id="before-installation"> <a href="#before-installation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Before installation</h3><p>Before installing COMOKIT, be sure to have on your server:</p><ul><li>64 bits server<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>lscpu | <span class="nb">head</span> <span class="nt">-n</span> 2
Architecture:                    x86_64
CPU op-mode<span class="o">(</span>s<span class="o">)</span>:                  32-bit, 64-bit
</code></pre></div></div><li>Python 3<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python3 <span class="nt">-V</span>
Python 3.8.2
</code></pre></div></div><li>pip3<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pip3 <span class="nt">-V</span>
pip 20.1.1 from /home/roiarthurb/.local/lib/python3.8/site-packages/pip <span class="o">(</span>python 3.8<span class="o">)</span>
</code></pre></div></div><li>(if you do not use GAMA with JDK) JDK 8<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>java <span class="nt">-version</span>
openjdk version <span class="s2">"1.8.0_242"</span>
OpenJDK Runtime Environment <span class="o">(</span>build 1.8.0_242-b08<span class="o">)</span>
OpenJDK 64-Bit Server VM <span class="o">(</span>build 25.242-b08, mixed mode<span class="o">)</span>
</code></pre></div></div></ul><h3 id="installation"> <a href="#installation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Installation</h3><p>To install COMOKIT Headless on your server you can either <a href="https://github.com/COMOKIT/COMOKIT-Model/releases/">download a COMOKIT release</a> and the <a href="https://github.com/COMOKIT/COMOKIT-HPC">headless tools</a> or directly download the <a href="https://github.com/COMOKIT/COMOKIT-HPC/releases/">HPC archive</a> (which packages GAMA with an embedeed JDK, COMOKIT for Linux and the needed tools).</p><blockquote><p>If you don’t use a version of GAMA provided with one of our release, be sure to use <a href="https://github.com/gama-platform/gama/releases/tag/1.8.1">GAMA 1.8.1 version</a> (or <a href="https://github.com/gama-platform/gama/releases">above</a>) and a <a href="https://en.wikipedia.org/wiki/Java_version_history#Java_SE_8">JAVA Developpement Kit (JDK) 8</a>.</p></blockquote><h3 id="setting-up-your-server"> <a href="#setting-up-your-server" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Setting up your server</h3><p>To have your tooly-scripts ready to run, be sure to install all the required python’s modules like so</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pip3 install -r /path/to/COMOKIT-HPC/pre-processing/required.txt
</code></pre></div></div><h2 id="how-to-use"> <a href="#how-to-use" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> How to use:</h2><h3 id="generate-xml"> <a href="#generate-xml" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Generate XML</h3><p>GAMA Headless mode needs an XML configuration file in order to run GAMA. The HPC toolkit allows to generate it automatically.</p><ul><li>move to the folder pre-processing <code class="language-plaintext highlighter-rouge">$ cd /path-to/COMOKIT-HPC/pre-processing</code><li>run <code class="language-plaintext highlighter-rouge">generateMultipleXML.py</code> with arguments to create the XML file and run GAMA. Basic usage is described below.</ul><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python3 generateMultipleXML.py <span class="nt">-h</span>
usage: <span class="nv">$ </span>python3 generateMultipleXML.py <span class="o">[</span>options] <span class="nt">-f</span> INT <span class="nt">-xml</span> &lt;experiment name&gt; /path/to/file.gaml /path/to/file.xml

optional arguments:
  <span class="nt">-h</span>, <span class="nt">--help</span>            show this <span class="nb">help </span>message and <span class="nb">exit</span>
  <span class="nt">-r</span> INT, <span class="nt">--replication</span> INT
                        Number of replication <span class="k">for </span>each paramater space <span class="o">(</span>default: 1<span class="o">)</span>
  <span class="nt">-s</span> INT, <span class="nt">--split</span> INT   Split XML file every S replications <span class="o">(</span>default: 1<span class="o">)</span>
  <span class="nt">-o</span> STR, <span class="nt">--output</span> STR  Relative path from GAML file to folder where save output CSV <span class="o">(</span>default:
                        <span class="s2">"../../batch_output"</span> <span class="o">=&gt;</span> /path/to/COMOKIT-Model/COMOKIT/batch_output<span class="o">)</span>
  <span class="nt">-u</span> STR, <span class="nt">--until</span> STR   Stop condition <span class="k">for </span>the simulations <span class="o">(</span>default: <span class="s2">"world.sim_stop()"</span>
  <span class="nt">-S</span> INT, <span class="nt">--seed</span> INT    Starting value <span class="k">for </span>seeding simulation <span class="o">(</span>default: 0<span class="o">)</span>
  <span class="nt">-f</span> INT, <span class="nt">--final</span> INT   Final step <span class="k">for </span>simulations
  <span class="nt">-xml</span> &lt;experiment name&gt; /path/to/file.gaml /path/to/file.xml
                        Classical xml arguments
</code></pre></div></div><h3 id="example-usage"> <a href="#example-usage" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Example usage</h3><p>COMOKIT provide you an XML example to launch the headless.</p><p><img src="assets/images/arboToXMLFile.png" alt="arbo to XML file" /></p><p>It has been generated with the command below</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /path/to/COMOKIT-Model/COMOKIT/Utilities

<span class="nv">$ </span>python3 ~/path/to/COMOKIT-HPC/pre-processing/generateMultipleXML.py <span class="nt">-xml</span> <span class="s2">"SensitivityHeadless"</span> ../Experiments/Sensitivity<span class="se">\ </span>Analysis/Sensitivity<span class="se">\ </span>Analysis.gaml  ./testHeadless.xml <span class="nt">-f</span> 20 
Total number of parameters detected : 0
Total number of possible combinaison : 1
	Replications : 1
	Number of exp <span class="k">in </span>file : <span class="nt">-1</span>
	Final step : 20
<span class="o">===</span> Start generating XML file :
<span class="o">(</span>every dot will be a simulation with all the replications created<span class="o">)</span>
<span class="nb">.</span>
<span class="o">===</span> Start saving XML file

<span class="o">===</span> Done <span class="p">;</span><span class="o">)</span>
</code></pre></div></div><p>In the command above, we said that we want to generate an XML file with the experiment <em>SensitivityHeadless</em> from the file <em>Experiments/Sensitivity Analysis/Sensitivity Analysis.gaml</em> and save it at <em>./testHeadless.xml</em>. We also precised that the simulation should stop after 20 steps (if not stopped before).</p><p>This command is the smallest command possible, but we can go way deeper in the customization as we will see after.</p><p>The generated XML looks like this :</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Experiment_plan&gt;</span>
	<span class="nt">&lt;Simulation</span> <span class="na">experiment=</span><span class="s">"SensitivityHeadless"</span> <span class="na">finalStep=</span><span class="s">"20"</span> <span class="na">id=</span><span class="s">"0"</span> <span class="na">seed=</span><span class="s">"0"</span> <span class="na">sourcePath=</span><span class="s">"../Experiments/Sensitivity Analysis/Sensitivity Analysis.gaml"</span> <span class="na">until=</span><span class="s">"world.sim_stop()"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;Parameters&gt;</span>
			<span class="nt">&lt;Parameter</span> <span class="na">type=</span><span class="s">"INT"</span> <span class="na">value=</span><span class="s">"0"</span> <span class="na">var=</span><span class="s">"idSimulation"</span><span class="nt">/&gt;</span>
			<span class="nt">&lt;Parameter</span> <span class="na">type=</span><span class="s">"STRING"</span> <span class="na">value=</span><span class="s">"../batch_output/"</span> <span class="na">var=</span><span class="s">"result_folder"</span><span class="nt">/&gt;</span>
		<span class="nt">&lt;/Parameters&gt;</span>
		<span class="nt">&lt;Outputs/&gt;</span>
	<span class="nt">&lt;/Simulation&gt;</span>
<span class="nt">&lt;/Experiment_plan&gt;</span>
</code></pre></div></div><h3 id="advanced-usage"> <a href="#advanced-usage" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Advanced usage</h3><p>As you can see, our previous command only generated an <code class="language-plaintext highlighter-rouge">Experiment Plan</code> with a single <code class="language-plaintext highlighter-rouge">Simulation</code>. This example is the simpliest usage to give you a try runnable on your computer, but it doesn’t fit if you want to do a full exploration on a server.</p><p>To do so you can change the script parameters to generate a bigger exploration plan like this :</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python3 ~/path/to/COMOKIT-HPC/pre-processing/generateMultipleXML.py <span class="se">\</span>
	<span class="nt">-xml</span> <span class="s2">"SensitivityHeadless"</span> ../Experiments/Sensitivity<span class="se">\ </span>Analysis/Sensitivity<span class="se">\ </span>Analysis.gaml  ./testHeadless.xml <span class="se">\</span>
	<span class="nt">-o</span> ../results/ <span class="nt">-r</span> 1000 <span class="se">\</span>
	<span class="nt">-s</span> 36 <span class="nt">-f</span> 5000
Total number of parameters detected : 0
Total number of possible combinaison : 1
	Replications : 1000
	Number of exp <span class="k">in </span>file : 36
	Final step : 5000
<span class="o">===</span> Start generating XML file :
<span class="o">(</span>every dot will be a simulation with all the replications created<span class="o">)</span>
.....................................................................................................................
.....................................................................................................................
.....................................................................................................................
.....................................................................................................................
.....................................................................................................................
.....................................................................................................................
.....................................................................................................................
.....................................................................................................................
................................................................
<span class="o">===</span> Start saving XML file

<span class="o">===</span> Done <span class="p">;</span><span class="o">)</span>

<span class="nv">$ </span><span class="c"># Check generated XML files</span>
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> <span class="k">*</span>.xml | <span class="nb">wc</span> <span class="nt">-l</span>
29
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-lh</span> <span class="k">*</span>.xml | <span class="nb">head</span>  
<span class="nt">-rw-r--r--</span>  1 roiarthurb roiarthurb  15K 26 mai   10:31 testHeadless-0.xml
<span class="nt">-rw-r--r--</span>  1 roiarthurb roiarthurb  16K 26 mai   10:31 testHeadless-10.xml
<span class="nt">-rw-r--r--</span>  1 roiarthurb roiarthurb  16K 26 mai   10:31 testHeadless-11.xml
<span class="nt">-rw-r--r--</span>  1 roiarthurb roiarthurb  16K 26 mai   10:31 testHeadless-12.xml
<span class="nt">-rw-r--r--</span>  1 roiarthurb roiarthurb  16K 26 mai   10:31 testHeadless-13.xml
<span class="nt">-rw-r--r--</span>  1 roiarthurb roiarthurb  16K 26 mai   10:31 testHeadless-14.xml
<span class="nt">-rw-r--r--</span>  1 roiarthurb roiarthurb  16K 26 mai   10:31 testHeadless-15.xml
</code></pre></div></div><p>So, with this advances command we created an <code class="language-plaintext highlighter-rouge">Experiment Plan</code> with 1000 simulations (1 combinaison times 1000 replications, done with the argument <code class="language-plaintext highlighter-rouge">-r</code>) splited in several files so every file contain 36 <code class="language-plaintext highlighter-rouge">Simulation</code> (<code class="language-plaintext highlighter-rouge">-s</code>).</p><blockquote><p>Note that if you split your XML file, it will automatically change the name to have a unique id on every file.</p></blockquote><h2 id="launch-headless"> <a href="#launch-headless" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Launch headless</h2><p>Once you have your XML files, you’re ready to launch the GAMA headless with a simple command :</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bash /path/to/GAMA/headless/gama-headless.sh ./testHeadless-0.xml ./output
</code></pre></div></div><blockquote><p>The 2 script’s parameter (<code class="language-plaintext highlighter-rouge">./output</code>) is never use within COMOKIT but is requested by the GAMA Headless, so don’t mind about this folder content. All the CSV raw data are saved in the location precised while you’ve been creating your XML files.</p></blockquote><p>If you need more explainations about the headless, please refer to the official <a href="https://gama-platform.github.io/wiki/Headless#command">GAMA documentation</a>.</p><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-000 mb-0">Copyright &copy; 2023 COMOKIT. Distributed by an <a href="https://github.com/COMOKIT/COMOKIT-Model/tree/master/LICENSE">GPL 3-0 license.</a></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/COMOKIT/COMOKIT-Website/edit/master/docs/docs/headless.md" id="edit-this-page" target="_blank">Edit this page on GitHub</a></p></div></footer></div></div></div></div>
